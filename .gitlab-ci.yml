# Use Playwright official image with Node + browsers pre-installed
image: mcr.microsoft.com/playwright:v1.42.1-focal

stages:
  - test

variables:
  HEADLESS: "true"    # ensure headless browser in CI

# Job to run TAS tests
run_tas:
  stage: test
  script:
    # Install Node dependencies
    - npm ci
    # Ensure browsers are installed (Playwright)
    - npx playwright install
    # Run only games tests via your npm script
    - npm run testGames
  rules:
    # Run when triggered from another pipeline
    - if: '$CI_PIPELINE_SOURCE == "trigger"'
      when: always
    # Run on schedule
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: always
    # Run manually or on push to main
    - if: '$CI_COMMIT_BRANCH == "main"'
      when: manual
